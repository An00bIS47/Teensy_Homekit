; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
;
;
; have a look here for detaiiled features etc. 
; https://github.com/MarlinFirmware/Marlin/blob/2.0.x/platformio.ini

[platformio]
default_envs = teensy_41

[common]
lib_deps = 
	QRCode
	;FastLED
	StreamUtils

default_src_filter = 
	+<*>
	-<Crypto/tutils.c>


plugin_src_filter = 
	-<HAP/plugins/FanHoneywell/HAPPluginFanHoneywell.cpp>
	-<HAP/plugins/DHT/HAPPluginDHT.cpp>
	;-<HAP/plugins/BME280/HAPPluginBME280.cpp>
	-<HAP/plugins/InfluxDB/HAPPluginInfluxDB.cpp>
	-<HAP/plugins/IR/HAPPluginIRDevice.cpp>
	-<HAP/plugins/IR/HAPPluginIR.cpp>
	-<HAP/plugins/PCA301/HAPPluginPCA301.cpp>
	-<HAP/plugins/PCA301/HAPPluginPCA301Device.cpp>
	-<HAP/plugins/PCA301/funky_rfm69.cpp>
	-<HAP/plugins/Nimble_MiFlora/HAPPluginNimbleMiFlora.cpp>
	-<HAP/plugins/Nimble_MiFlora/HAPPluginNimbleMiFloraDevice.cpp>
	-<HAP/plugins/RF24/HAPPluginRF24.cpp>
	-<HAP/plugins/RCSwitch/HAPPluginRCSwitch.cpp>
	-<HAP/plugins/RCSwitch/HAPPluginRCSwitchDevice.cpp>
	-<HAP/plugins/RF24/HAPPluginRF24DeviceWeather.cpp>
	-<HAP/plugins/RF24/HAPPluginRF24DeviceDHT.cpp>
	-<HAP/plugins/Hygrometer/HAPPluginHygrometer.cpp>
	-<HAP/plugins/PCA301/funky_rfm69.cpp>
	-<HAP/plugins/PCA301/HAPPluginPCA301.cpp>
	-<HAP/plugins/PCA301/HAPPluginPCA301Device.cpp>
	-<HAP/plugins/SSD1306/HAPPluginSSD1306.cpp>
	-<HAP/plugins/SSD1331/HAPPluginSSD1331.cpp>
	-<HAP/plugins/LED/HAPPluginLED.cpp>
	-<HAP/plugins/NeoPixel/HAPPluginNeoPixel.cpp>	
	
build_flags = 
	-Wno-unknown-pragmas
	-Wno-sign-compare
	-Isrc/Crypto
	-Isrc/HAP
	-Isrc/HAP/plugins

feature_flags = 
	-D HAP_PIXEL_INDICATOR_ENABLED=0
	-D HAP_ENABLE_KEYSTORE=0
	-D HAP_ENABLE_WIFI=0
	-D HAP_ENABLE_NTP=1
	-D HAP_ENABLE_UPDATE_OTA=0
	-D HAP_ENABLE_UPDATE_WEB=0
	-D HAP_ENABLE_WEBSERVER=0
	-D HAP_CONFIG_USE_PREFS_FOR_PAIRINGS=0

plugin_flags = 
	-D HAP_PLUGIN_USE_BME280=1
	-D HAP_PLUGIN_BME280_USE_DUMMY=1	
	-Isrc/HAP/plugins/BME280
	-D HAP_PLUGIN_USE_KNX=0
	;-Isrc/HAP/plugins/KNX
	; -D HAP_PLUGIN_USE_DHT=1
	; -D HAP_PLUGIN_DHT_USE_DUMMY=1	
	; -Isrc/HAP/plugins/DHT

debug_flags = 
	-D HAP_DEBUG=1
	-D HAP_DEBUG_PAIRINGS=0
	-D HAP_DEBUG_HOMEKIT=1
	-D HAP_DEBUG_EVENTMANAGER=0
	-D HAP_DEBUG_HOMEKIT_REQUEST=1
	-D FNET_CFG_DEBUG_MDNS=1
	-D FNET_CFG_DEBUG=1

knx_flags = 
	-D KNX_USE_STREAMUTILS=1
	-D MASK_VERSION=0x07B0
	-D KNX_FLASH_SIZE=4284
	-D HAS_FUNCTIONAL=1

teensy_flags =
	;-D TEENSY_OPT_FASTER
	;-D TEENSY_OPT_FAST	
	;-D TEENSY_OPT_DEBUG	
	-D TEENSY_OPT_SMALLEST_CODE
	;-D USB_DUAL_SERIAL
	-D CORE_TEENSY

[env:teensy_41]
platform = teensy
framework = arduino

board = teensy41

build_flags = 	
	${common.feature_flags}
	${common.debug_flags}
	${common.plugin_flags}
	${common.knx_flags}
	${common.teensy_flags}
	${common.build_flags}
	-D HAP_RESET_EEPROM=0
	-D HAP_FAKEGATO_INTERVAL=60000	
	-D ARDUINOJSON_USE_LONG_LONG=1
	-D HAP_RESET_CONFIGURATION=0
	-D HAP_RESET_PAIRINGS=0
	-D HAP_USE_SPIFFS_CONFIGURATION=1

lib_deps = 
	${common.lib_deps}
	FNET
	NativeEthernet
	adamvr/base64@^1.0.0
	TeensyID
	

src_filter = 
	${common.default_src_filter}
	${common.plugin_src_filter}
	-<HAP/HAPKeystore.cpp>
	-<HAP/HAPWebServer.cpp>
	-<HAP/HAPWebServerBodyParserMultipart.cpp>
	-<HAP/HAPWebServerBodyParserURLEncoded.cpp>
	-<HAP/HAPWebServerFiles.cpp>
	-<HAP/HAPWebServerJWT.cpp>
	-<HAP/HAPWebServerTemplateProcessor.cpp>
	-<HAP/HAPFlash.cpp>
	-<HAP/HAPFileReader.cpp>
	-<HAP/HAPButton.cpp>
	-<HAP/HAPPreferencesExt.cpp>
	-<HAP/HAPWiFiHelper.cpp>
	-<HAP/HAPUpdate.cpp>
	-<HAP/HAPIndicatorPixel.cpp>
	-<HAP/HAPConfigurationPreferences.cpp>


; monitor_speed = 115200
; monitor_flags = 
; 	--raw	

;upload_port = /dev/cu.usbmodem84180903